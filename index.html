<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <script>
        var AppID = '1219494008524549';
        var FBLoaded = false;

        // [1] Load lên các thành phần cần thiết
        window.fbAsyncInit = function () {
            FB.init({
                appId: AppID,
                cookie: true,
                xfbml: true,
                version: 'v12.0'
            });
            FBLoaded = true;
            // Kiểm tra trạng thái hiện tại
            FB.getLoginStatus(function (response) {
                statusChangeCallback(response);
            });
        };

        // [2] Xử lý trạng thái đăng nhập
        function statusChangeCallback(response) {
            // Người dùng đã đăng nhập FB và đã đăng nhập vào ứng dụng
            if (response.status === 'connected') {
                ShowWelcome();
            }
            // Người dùng đã đăng nhập FB nhưng chưa đăng nhập ứng dụng
            else if (response.status === 'not_authorized') {
                ShowLoginButton();
            }
            // Người dùng chưa đăng nhập FB
            else {                
                ShowLoginButton();
            }
        }

        // [3] Yêu cầu đăng nhập FB
        function RequestLoginFB() {
            window.location = 'http://graph.facebook.com/oauth/authorize?client_id=' + AppID + '&scope=user_videos&redirect_uri=https://devbanh2k3.github.io&response_type=token';
            //FB.login(function (response) {
            //    // Sau khi đã hỏi người dùng xong
            //    FB.getLoginStatus(function (response) {
            //        statusChangeCallback(response);
            //    });
            //}, { scope: 'manage_pages,pages_show_list,public_profile,email,user_likes,user_birthday,user_education_history,user_work_history,user_posts,user_photos,user_location,publish_actions' });
        }

        // [4] Hiển thị nút đăng nhập
        function ShowLoginButton() {
            document.getElementById('btb').setAttribute('style', 'display:block');
            document.getElementById('lbl').setAttribute('style', 'display:none');
            document.getElementById('btbLogout').setAttribute('style', 'display:none');
        }

        // [5] Chào mừng người dùng đã đăng nhập
        function ShowWelcome() {
            document.getElementById('btb').setAttribute('style', 'display:none');
            document.getElementById('btbLogout').setAttribute('style', 'display:block');
            FB.api('/me', function (response) {
                var name = response.name;
                var id = response.id;
                document.getElementById('lbl').innerHTML = 'Tên=' + name;
                document.getElementById('lbl').setAttribute('style', 'display:block');
            });
        }

        // [6] Post status lên tường nhà
        function POST() {
            if (FBLoaded) {
                var ms = document.getElementById('message').value;
                var lk = 'http://sotayyte.com';
                var acp = 'KEY CỦA PAGE';
                FB.api('/me/feed', 'post', { message: ms, link: lk, access_token:acp }, function (response) {
                    if (!response || response.error) {
                        alert('Có lỗi khi POST bài: ');
                        console.log(response);
                    } else {
                        document.getElementById('postid').value = response.id;
                        alert('ĐÃ POST THÀNH CÔNG');
                    }
                });
            } else {
                setTimeout("POST()", 100);
            }
        }
         
        // [7] Delete status đã lên tường nhà
        function DELETE() {
            if (FBLoaded) {
                var postid = document.getElementById('postid').value;
                ac = 'KEY CỦA PAGE';
                FB.getLoginStatus(function(response) {
                    if (response.status === 'connected') {
                        alert(response.authResponse.accessToken);
                    }
                });
               
            } else {
                setTimeout("DELETE()", 100);
            }
        }

        // [8] Đăng xuất khỏi ứng
        function FBLogout() {
            if (FBLoaded) {
                // Logout
                FB.logout();
                // Kiểm tra lại trạng thái đăng nhập
                FB.getLoginStatus(function (response) {
                    statusChangeCallback(response);
                });
            } else {
                setTimeout("FBLogout()", 100);
            }
        }


    </script>
    <div id="fb-root"></div>
    <script>
    (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));</script>



    <!-- NÚT ĐĂNG NHẬP -->
    <fb:login-button 
    scope="public_profile,email,user_videos"
    onlogin="checkLoginState();">
    </fb:login-button>
    <input id="btb" type="button" value="ĐĂNG NHẬP" onclick="RequestLoginFB()" style="display:none" />
    <p id="lbl" style="display:none">BẠN ĐÃ ĐĂNG NHẬP THÀNH CÔNG!</p>
    <br />
    <input type="button" value="THOÁT" id="btbLogout" onclick="FBLogout()" />
    <br />


    <!-- HIỂN THỊ NÚT LUIKE -->
    <div class="fb-like" data-href="http://webcuatoi.com" data-layout="box_count" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
    <br />
    <!-- HIỂN THỊ PAGE -->
    <div class="fb-page" data-href="https://www.facebook.com/thuvienlaptrinh" data-tabs="timeline" data-width="300" data-height="70" data-small-header="true" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"><blockquote cite="https://www.facebook.com/thuvienlaptrinh" class="fb-xfbml-parse-ignore"><a href="https://www.facebook.com/thuvienlaptrinh">Thư Viện Lập Trình</a></blockquote></div>
    <br />
    <!-- COMMENT -->
    <div class="fb-comments" data-href="http://webcuatoi.com" data-numposts="10"></div>


    <p>POST THỬ</p>

        Message<br />
        <input type="text" name="message" id="message" />
        <br /><br />
        <input type="button" value="GỬI" onclick="POST()" />

        <br /><br /><br /><br />
        Post id<br />
        <input type="text" name="postid" id="postid" />
        <br /><br />
        <input type="button" value="XÓA" onclick="DELETE()" />

</body>
</html>
